var Formrunner=function(a){if("object"!=typeof a.targets||0===a.targets.length)throw new Error("Invalid or missing target element(s)");var b={form_id:!1,model:!1,targets:!1,action:"",method:"POST",templateBasePath:"templates/runner"},c=this;return this._opts=$.extend(!0,{},b,a),void 0===dust.onLoad&&(dust.onLoad=function(a,b){$.ajax(c._opts.templateBasePath+"/"+a+".tpl",{success:function(a){b(void 0,a)},error:function(a,c,d){b(c,void 0)}})}),this.render(),this},sortObject=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({key:c,value:a[c].sortOrder});b.sort(function(a,b){return a.value-b.value});for(var d=[],e=0,f=b.length;f>e;e++){var g=b[e].key;d.push(a[g])}return d};Formrunner.prototype={_opts:!1,render:function(){var a=this,b={form_id:a._opts.form_id,action:a._opts.action,method:a._opts.method};dust.render("base",b,function(b,c){a._opts.targets.append(c);var d=sortObject(a._opts.model);$.each(d,function(b,c){a.appendElementForModel(c)})})},appendElementForModel:function(a){var b=this,c={id:b.fieldNameToId(a.label),label:a.label,required:a.required};dust.render(a.type,c,function(c,d){b._opts.targets.find("form>ul").append(d);var e=b._opts.targets.find("form>ul>li:last-child");void 0!==a.choices&&a.choices.length>0&&$.each(a.choices,function(c,d){d.id=b.fieldNameToId(d.label),d.name=b.fieldNameToId(a.label),dust.render(a.type+"-choices",d,function(b,c){"select"===a.type?e.find("select").append(c):e.find(".frmb-choices").append(c)})})})},fieldNameToId:function(a){return a.toLowerCase().replace(/ /g,"-").replace(/[^a-zA-Z0-9_.-]/g,"")}};